<!-- 10. 休日カレンダー管理画面 (holiday/calendar.html) -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>休日カレンダー管理 - 勤怠管理システム</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .calendar-day {
            height: 100px;
            border: 1px solid #dee2e6;
            position: relative;
        }
        .holiday-day {
            background-color: #ffe6e6;
        }
        .calendar-date {
            position: absolute;
            top: 5px;
            left: 5px;
            font-weight: bold;
        }
        .holiday-name {
            position: absolute;
            bottom: 5px;
            left: 5px;
            font-size: 0.8em;
            color: #dc3545;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/main">勤怠管理システム</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/main">メイン画面</a>
                <a class="nav-link" href="/logout">ログアウト</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="card shadow">
            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">休日カレンダー管理</h4>
                <div>
                    <select class="form-select form-select-sm d-inline-block" style="width: auto;" 
                            onchange="location.href='/holiday/calendar?year=' + this.value">
                        <option th:each="y : ${years}" 
                                th:value="${y}" 
                                th:text="${y + '年'}" 
                                th:selected="${y == currentYear}">2024年</option>
                    </select>
                </div>
            </div>
            <div class="card-body p-2">
                <form th:action="@{/holiday/calendar/update}" method="post">
                    <input type="hidden" name="targetYear" th:value="${currentYear}">
                    
                    <!-- カレンダー表示 -->
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th class="text-center" width="14%">日</th>
                                    <th class="text-center" width="14%">月</th>
                                    <th class="text-center" width="14%">火</th>
                                    <th class="text-center" width="14%">水</th>
                                    <th class="text-center" width="14%">木</th>
                                    <th class="text-center" width="14%">金</th>
                                    <th class="text-center" width="14%">土</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="week : ${calendar}">
                                    <td th:each="day : ${week}" 
                                        th:class="${day.isHoliday} ? 'calendar-day holiday-day' : 'calendar-day'"
                                        th:if="${day.date != null}">
                                        <div class="calendar-date" th:text="${#dates.format(day.date, 'dd')}">01</div>
                                        <div th:if="${day.isHoliday}" class="holiday-name" th:text="${day.holidayName}">元日</div>
                                        <input type="checkbox" th:name="|holidays[${#dates.format(day.date, 'MM-dd')}].isHoliday|" 
                                               th:checked="${day.isHoliday}" 
                                               style="position: absolute; top: 5px; right: 5px;">
                                        <input type="text" th:name="|holidays[${#dates.format(day.date, 'MM-dd')}].holidayName|" 
                                               th:value="${day.holidayName}"
                                               th:if="${day.isHoliday}"
                                               class="form-control form-control-sm mt-4" 
                                               style="font-size: 0.7em; position: absolute; bottom: 25px; left: 5px; right: 5px;"
                                               placeholder="休日名">
                                    </td>
                                    <td th:if="${day.date == null}" class="calendar-day bg-light"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-3 d-flex justify-content-between">
                        <div>
                            <button type="button" class="btn btn-info btn-sm" onclick="setNationalHolidays()">
                                国民の祝日を一括設定
                            </button>
                            <button type="button" class="btn btn-warning btn-sm" onclick="clearAllHolidays()">
                                すべてクリア
                            </button>
                        </div>
                        <div>
                            <a href="/main" class="btn btn-secondary">キャンセル</a>
                            <button type="submit" class="btn btn-danger">確認画面へ</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function setNationalHolidays() {
            // 国民の祝日の自動設定（例：元日、建国記念の日など）
            const holidays = {
                '01-01': '元日',
                '02-11': '建国記念の日',
                '04-29': '昭和の日',
                '05-03': '憲法記念日',
                '05-04': 'みどりの日',
                '05-05': 'こどもの日',
                '07-20': '海の日',
                '08-11': '山の日',
                '09-21': '敬老の日',
                '10-12': 'スポーツの日',
                '11-03': '文化の日',
                '11-23': '勤労感謝の日'
            };
            
            for (const [date, name] of Object.entries(holidays)) {
                const checkbox = document.querySelector(`input[name="holidays[${date}].isHoliday"]`);
                const nameInput = document.querySelector(`input[name="holidays[${date}].holidayName"]`);
                
                if (checkbox) {
                    checkbox.checked = true;
                }
                if (nameInput) {
                    nameInput.value = name;
                }
            }
        }

        function clearAllHolidays() {
            if (confirm('すべての休日設定をクリアします。よろしいですか？')) {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="text"]').forEach(input => input.value = '');
            }
        }
    </script>
</body>
</html>